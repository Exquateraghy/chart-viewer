<!DOCTYPE html>
<html>
<head>
  <title>Stock Chart Viewer</title>
  <script src="https://unpkg.com/lightweight-charts@4.3.0/dist/lightweight-charts.standalone.production.min.js"></script>

  <style>
    body {
      margin: 0;
      background: #f1f3f6;
      font-family: Arial, sans-serif;
    }
    #chart {
      width: 100%;
      height: 600px;
    }
  </style>
</head>
<body>
  <div id="chart"></div>

  <script>
    const apiKey = "b5fe46e312mshf5f3fc4311c126ap14ab3bjsnd574a52c11b4";

    function getURLParam(param) {
      const params = new URLSearchParams(window.location.search);
      return params.get(param);
    }

    async function fetchOHLC(ticker) {
      const url = `https://yfapi.net/v8/finance/chart/${ticker}?range=1mo&interval=1d`;

      const response = await fetch(url, {
        method: 'GET',
        headers: {
          'x-api-key': apiKey
        }
      });

      const json = await response.json();
      const timestamps = json.chart.result[0].timestamp;
      const ohlc = json.chart.result[0].indicators.quote[0];

      const candleData = timestamps.map((time, i) => ({
        time: time,
        open: ohlc.open[i],
        high: ohlc.high[i],
        low: ohlc.low[i],
        close: ohlc.close[i]
      }));

      return candleData;
    }

    async function loadChart(ticker) {
      const chart = LightweightCharts.createChart(document.getElementById('chart'), {
        layout: {
          background: { color: '#fff' },
          textColor: '#000',
        },
        grid: {
          vertLines: { color: '#eee' },
          horzLines: { color: '#eee' }
        },
        priceScale: { borderColor: '#d1d4dc' },
        timeScale: { borderColor: '#d1d4dc' }
      });

      const series = chart.addCandlestickSeries();

      try {
        const data = await fetchOHLC(ticker);
        series.setData(data);
      } catch (e) {
        alert("Failed to load data for " + ticker);
        console.error(e);
      }
    }

    window.onload = () => {
      const ticker = getURLParam("ticker");
      if (ticker) loadChart(ticker);
    };
  </script>
</body>
</html>
