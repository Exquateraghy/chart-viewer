<!DOCTYPE html>
<html>
<head>
  <title>Daily Stock Chart (Yahoo Finance + Lightweight Charts)</title>
  <style>
    #chartContainer { width: 100%; height: 600px; }
  </style>
</head>
<body>
  <div id="chartContainer"></div>
  <script src="https://unpkg.com/lightweight-charts@4.0.0/dist/lightweight-charts.standalone.production.js"></script>
  <script>
    async function fetchDailyData(ticker) {
      const url = `https://apidojo-yahoo-finance-v1.p.rapidapi.com/stock/v2/get-chart?symbol=${ticker}&interval=1d&range=6mo&region=US`;
      const response = await fetch(url, {
        method: 'GET',
        headers: {
          'X-RapidAPI-Key': 'b5fe46e312mshf5f3fc4311c126ap14ab3bjsnd574a52c11b4',  // replace with your key
          'X-RapidAPI-Host': 'apidojo-yahoo-finance-v1.p.rapidapi.com'
        }
      });
      if (!response.ok) throw new Error(`API error: ${response.status}`);
      return response.json();
    }

    function transformToCandles(data) {
      const result = data.chart.result[0];
      const timestamps = result.timestamp;
      const quote = result.indicators.quote[0];
      return timestamps.map((t, i) => ({
        time: t,
        open: quote.open[i],
        high: quote.high[i],
        low: quote.low[i],
        close: quote.close[i]
      })).filter(c => c.open != null);
    }

    async function drawChart() {
      const ticker = 'AAPL';
      const rawData = await fetchDailyData(ticker);
      const candles = transformToCandles(rawData);

      const chart = LightweightCharts.createChart(document.getElementById('chartContainer'), {
  width: window.innerWidth,
  height: 600,
  timeScale: {
    timeVisible: true,
    secondsVisible: false,
    tickMarkFormatter: time => {
      const date = new Date(time * 1000);
      return date.toISOString().slice(0, 10);
    }
  },
  localization: {
    timeFormatter: time => {
      const date = new Date(time * 1000);
      return date.toISOString().slice(0, 10);
    }
  }
});


      const candleSeries = chart.addCandlestickSeries();
      candleSeries.setData(candles);

      window.addEventListener('resize', () => {
        chart.applyOptions({ width: window.innerWidth });
      });
    }

    drawChart().catch(e => {
      document.getElementById('chartContainer').innerText = e.message;
      console.error(e);
    });
  </script>
</body>
</html>
